<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Voting Portal â€“ State Forge</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="tailwind.css">
</head>
<body class="bg-gray-50 font-sans min-h-screen">

  <!-- NAVBAR -->
  <nav class="bg-legend-blue text-white px-6 py-4 flex items-center justify-between shadow">
    <div class="flex items-center gap-3">
      <img src="images/State-Forge-Shield-White-on-Blue.png" alt="Logo" class="w-8 h-8 p-1 rounded-full" />
      <span class="text-xl font-semibold">State Forge <span class="text-sm font-normal text-legend-gold ml-2">Voting Portal</span></span>
    </div>
  </nav>

  <main class="flex-1 p-6 lg:p-10 bg-gray-50 min-h-screen max-w-4xl mx-auto">
    <!-- Error/Success Messages -->
    <div id="errorBox" class="hidden bg-red-100 text-red-700 px-4 py-3 rounded-xl mb-4 shadow"></div>
    <div id="successBox" class="hidden bg-green-100 text-green-700 px-4 py-3 rounded-xl mb-4 shadow"></div>

    <!-- ============================================================ -->
    <!-- VOTER IDENTIFICATION SECTION (shown before voter is identified) -->
    <!-- ============================================================ -->
    <div id="voter-id-section" class="bg-white rounded-2xl shadow-lg p-8 mb-8 border-t-4 border-legend-gold">
      <h1 class="text-2xl font-bold text-legend-blue mb-2">Welcome to the Voting Portal</h1>
      <p class="text-gray-700 mb-6">Enter your 6-digit voter ID to access your ballot.</p>

      <div class="mb-4">
        <label for="voter-id-input" class="block text-sm font-medium text-gray-700 mb-1">Voter ID</label>
        <input
          type="text"
          id="voter-id-input"
          placeholder="Enter your 6-digit voter ID"
          maxlength="6"
          pattern="\d{6}"
          inputmode="numeric"
          class="w-full max-w-xs border border-gray-300 rounded-lg px-4 py-3 text-xl tracking-widest text-center focus:outline-none focus:ring-2 focus:ring-legend-blue"
          autocomplete="off"
        />
      </div>

      <button id="voter-id-submit-btn" class="bg-legend-blue hover:bg-blue-800 text-white font-semibold py-3 px-6 rounded-lg shadow transition">
        Continue
      </button>

      <div id="voter-id-status" class="mt-4 text-sm hidden"></div>
    </div>

    <!-- ============================================================ -->
    <!-- VOTING PORTAL CONTENT (shown after voter is identified) -->
    <!-- This section is shared between public and admin portals -->
    <!-- ============================================================ -->
    <div id="voting-portal-content" class="hidden">

      <!-- Voter Welcome Banner -->
      <div id="voter-welcome" class="bg-white rounded-2xl shadow-lg p-6 mb-6 border-l-4 border-legend-blue">
        <div class="flex items-center justify-between flex-wrap gap-4">
          <div>
            <h2 class="text-xl font-bold text-legend-blue">Welcome, <span id="voter-name"></span>!</h2>
            <p class="text-gray-600 text-sm mt-1">
              <span id="voter-grouping"></span>
              <span id="voter-party-badge" class="ml-2 px-2 py-1 rounded-full text-xs font-semibold text-white"></span>
            </p>
          </div>
          <button id="change-voter-btn" class="bg-legend-blue hover:bg-blue-800 text-white text-sm font-semibold py-2 px-4 rounded-lg shadow transition">
            Done
          </button>
        </div>
      </div>

      <!-- ============================================================ -->
      <!-- PARTY SELECTION SECTION (shown for Open/Semi-Open primaries) -->
      <!-- ============================================================ -->
      <div id="party-selection-section" class="hidden bg-white rounded-2xl shadow-lg p-6 mb-6 border-t-4 border-purple-500">
        <h3 class="text-lg font-bold text-legend-blue mb-2">Select Your Primary</h3>
        <p id="party-selection-description" class="text-gray-600 text-sm mb-4">
          Choose which party's primary election you want to participate in.
        </p>
        <p id="party-selection-locked-message" class="hidden text-amber-700 text-sm mb-4 bg-amber-50 p-3 rounded-lg">
          You have already voted in a primary. You can continue voting in the same party's primaries.
        </p>
        <div id="party-selection-buttons" class="flex flex-wrap gap-3">
          <!-- Party buttons will be inserted here -->
        </div>
      </div>

      <!-- Elections List Section -->
      <div id="elections-section" class="bg-white rounded-2xl shadow-lg p-6 mb-6">
        <h3 class="text-lg font-bold text-legend-blue mb-4">Your Elections</h3>
        <p class="text-gray-600 text-sm mb-4">Select an election to cast your vote.</p>

        <div id="elections-list" class="space-y-3">
          <p class="text-gray-500 italic">Loading elections...</p>
        </div>

        <div id="no-elections-message" class="hidden text-center py-8">
          <p class="text-gray-500 text-lg">No active elections available at this time.</p>
          <p class="text-gray-400 text-sm mt-2">Check back later or contact your counselor.</p>
        </div>
      </div>

      <!-- ============================================================ -->
      <!-- VOTING SECTION (shown when an election is selected) -->
      <!-- ============================================================ -->
      <div id="voting-section" class="hidden bg-white rounded-2xl shadow-lg p-6 mb-6 border-t-4 border-legend-gold">
        <div class="flex items-center justify-between mb-4">
          <div>
            <h3 id="election-title" class="text-lg font-bold text-legend-blue"></h3>
            <p id="election-subtitle" class="text-gray-600 text-sm mt-1"></p>
          </div>
          <button id="back-to-elections-btn" class="text-sm text-legend-blue hover:underline">
            &larr; Back to Elections
          </button>
        </div>

        <!-- Candidates List (Plurality voting) -->
        <div id="plurality-voting" class="hidden">
          <p class="text-gray-700 mb-4">Select one candidate:</p>
          <div id="candidates-list" class="space-y-3">
            <!-- Candidate radio buttons will be inserted here -->
          </div>
        </div>

        <!-- Candidates List (Ranked Choice Voting) -->
        <div id="rcv-voting" class="hidden">
          <p class="text-gray-700 mb-4">Drag candidates to rank them in order of preference (1st choice at top):</p>
          <div id="rcv-candidates-list" class="space-y-2">
            <!-- RCV drag-and-drop list will be inserted here -->
          </div>
          <p class="text-gray-500 text-xs mt-2">Tip: You don't have to rank all candidates.</p>
        </div>

        <!-- Already Voted Message -->
        <div id="already-voted-message" class="hidden text-center py-6">
          <div class="inline-flex items-center justify-center w-16 h-16 bg-green-100 rounded-full mb-4">
            <svg class="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
            </svg>
          </div>
          <p class="text-green-700 text-lg font-semibold">You have already voted in this election.</p>
          <p class="text-gray-500 text-sm mt-2">Your vote has been recorded.</p>
        </div>

        <!-- Cast Vote Button -->
        <div id="cast-vote-container" class="mt-6 pt-4 border-t border-gray-200">
          <button id="cast-vote-btn" class="w-full bg-legend-blue hover:bg-blue-800 text-white font-bold py-3 px-6 rounded-lg shadow transition disabled:opacity-50 disabled:cursor-not-allowed" disabled>
            Cast Vote
          </button>
        </div>
      </div>

      <!-- ============================================================ -->
      <!-- CONFIRMATION SECTION (shown after vote is cast) -->
      <!-- ============================================================ -->
      <div id="confirmation-section" class="hidden bg-white rounded-2xl shadow-lg p-8 mb-6 text-center">
        <div class="inline-flex items-center justify-center w-20 h-20 bg-green-100 rounded-full mb-6">
          <svg class="w-10 h-10 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
          </svg>
        </div>
        <h3 class="text-2xl font-bold text-green-700 mb-2">Vote Recorded!</h3>
        <p class="text-gray-600 mb-6">Your vote has been successfully cast.</p>
        <button id="back-to-elections-after-vote-btn" class="bg-legend-blue hover:bg-blue-800 text-white font-semibold py-3 px-6 rounded-lg shadow transition">
          Return to Elections
        </button>
      </div>

    </div>
  </main>

  <footer class="bg-legend-blue text-white border-t mt-8 py-4 text-center text-xs">
    &copy; 2025 State Forge. Not affiliated with or endorsed by the American Legion.
  </footer>

  <script src="js/config.js"></script>
  <!--
    IMPORTANT: voting-portal.js contains shared voting logic used by BOTH:
    - voting-portal.html (public delegate portal)
    - voting-portal-admin.html (authenticated admin portal)

    When modifying voting behavior, ensure changes work for both portals.
    The admin portal uses the same voting UI but with delegate dropdown instead of voter ID input.
  -->
  <script src="js/voting-portal.js"></script>
  <script src="js/voting-portal-public.js"></script>
</body>
</html>
